<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Demo Mode - DecisionSpark</title>
 <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <style>
        body {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
         min-height: 100vh;
     padding: 20px 0;
        }
        .card {
            border-radius: 15px;
   box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            border: none;
 }
        .card-header {
       background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
       color: white;
      border-radius: 15px 15px 0 0 !important;
   }
        .conversation-area {
     max-height: 500px;
            overflow-y: auto;
        padding: 20px;
    background-color: #f8f9fa;
            border-radius: 10px;
        }
  .message {
      padding: 15px;
       border-radius: 10px;
         margin-bottom: 15px;
    animation: fadeIn 0.3s ease-in;
        }
        @@keyframes fadeIn {
         from { opacity: 0; transform: translateY(10px); }
to { opacity: 1; transform: translateY(0); }
  }
        .message.assistant {
       background-color: #d1f2eb;
            border-left: 4px solid #11998e;
        }
   .message.user {
background-color: #f1f8e9;
          border-left: 4px solid #38ef7d;
        }
     .message.recommendation {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
      color: white;
        }
 .btn-demo {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
       border: none;
 color: white;
     }
     .btn-demo:hover {
        transform: scale(1.05);
        }
    </style>
</head>
<body>
    <div class="container">
    <div class="text-center mb-4">
     <h1 class="text-white display-4 fw-bold">
   <i class="bi bi-play-circle-fill"></i> Demo Mode
    </h1>
  <p class="text-white lead">Simplified Testing (No API Key Required)</p>
            <a href="/" class="btn btn-light">
      <i class="bi bi-arrow-left"></i> Back to Main Interface
        </a>
        </div>

        <div class="row">
            <div class="col-md-8">
  <div class="card">
 <div class="card-header">
        <h5 class="mb-0"><i class="bi bi-chat-square-text"></i> Demo Conversation</h5>
         </div>
                    <div class="card-body">
              <div class="conversation-area" id="conversationArea">
       <div class="text-center text-muted py-5">
      <i class="bi bi-chat-dots display-1"></i>
          <p class="mt-3">Click "Start Demo" to begin</p>
                 </div>
      </div>

    <div class="mt-3" id="inputArea" style="display: none;">
        <form id="answerForm">
             <div class="mb-3">
    <label for="userInput" class="form-label fw-bold">Your Answer:</label>
           <textarea class="form-control" id="userInput" rows="2" required></textarea>
  <small class="form-text text-muted" id="instructionsText"></small>
      </div>
 <button type="submit" class="btn btn-demo" id="sendBtn">
        <i class="bi bi-send-fill"></i> Send Answer
    </button>
       </form>
   </div>
            </div>
     </div>
          </div>

   <div class="col-md-4">
       <div class="card">
         <div class="card-header">
       <h5 class="mb-0"><i class="bi bi-gear-fill"></i> Demo Controls</h5>
        </div>
         <div class="card-body">
        <button class="btn btn-demo w-100 mb-2" onclick="startDemo()">
        <i class="bi bi-play-circle-fill"></i> Start Demo
 </button>
   <button class="btn btn-warning w-100 mb-2" onclick="resetDemo()">
     <i class="bi bi-arrow-clockwise"></i> Reset
    </button>
      <hr>
    <h6 class="fw-bold">Quick Scenarios:</h6>
        <button class="btn btn-outline-success w-100 mb-2" onclick="runQuickScenario('bowling')">
         ?? Bowling
   </button>
    <button class="btn btn-outline-success w-100 mb-2" onclick="runQuickScenario('movie')">
    ?? Movie Night
     </button>
              <button class="btn btn-outline-success w-100 mb-2" onclick="runQuickScenario('golf')">
      ? Golfing
       </button>
              </div>
                </div>

       <div class="card mt-3">
         <div class="card-header">
     <h5 class="mb-0"><i class="bi bi-info-circle-fill"></i> About Demo Mode</h5>
         </div>
        <div class="card-body">
     <p class="small">
                <strong>Demo mode</strong> uses simplified endpoints that don't require API keys.
       Perfect for testing and demonstrations!
               </p>
 <p class="small mb-0">
       <strong>Base URL:</strong><br>
            <code>@ViewBag.BaseUrl/demo</code>
             </p>
                 </div>
      </div>
   </div>
   </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const BASE_URL = '@ViewBag.BaseUrl';
        let currentSessionId = null;

        async function startDemo() {
     try {
   showLoading('Starting demo...');
              const response = await fetch(`${BASE_URL}/demo/start`);
          const data = await response.json();
        
      clearConversation();
     currentSessionId = data.sessionId;
            
      addMessage('assistant', data.message);
addMessage('assistant', data.currentQuestion);
        
        showInputArea(data.instructions);
  } catch (error) {
     console.error('Error:', error);
    addMessage('error', 'Failed to start demo: ' + error.message);
   }
        }

   document.getElementById('answerForm').addEventListener('submit', async (e) => {
e.preventDefault();
            
     const userInput = document.getElementById('userInput').value.trim();
       if (!userInput || !currentSessionId) return;

 try {
         document.getElementById('sendBtn').disabled = true;
 addMessage('user', userInput);
   document.getElementById('userInput').value = '';

        const response = await fetch(`${BASE_URL}/demo/answer/${currentSessionId}`, {
       method: 'POST',
             headers: { 'Content-Type': 'application/json' },
       body: JSON.stringify({ answer: userInput })
          });

   const data = await response.json();

           if (!response.ok) {
                addMessage('error', data.error || 'Invalid answer');
        if (data.currentQuestion) {
            addMessage('assistant', data.currentQuestion);
  }
          return;
        }

           if (data.message) {
        addMessage('assistant', data.message);
      }

       if (data.isComplete && data.recommendation) {
      const rec = data.recommendation;
      addRecommendation(rec.title, rec.description, rec.details);
              document.getElementById('inputArea').style.display = 'none';
                } else if (data.currentQuestion) {
       addMessage('assistant', data.currentQuestion);
       if (data.instructions) {
        document.getElementById('instructionsText').textContent = data.instructions;
 }
      }
   } catch (error) {
         console.error('Error:', error);
      addMessage('error', 'Failed to submit answer: ' + error.message);
            } finally {
          document.getElementById('sendBtn').disabled = false;
  }
        });

        async function runQuickScenario(name) {
    try {
    showLoading(`Running ${name} scenario...`);
         const response = await fetch(`${BASE_URL}/demo/scenario/${name}`);
     const data = await response.json();

     clearConversation();
      currentSessionId = data.sessionId;

         data.conversation.forEach(step => {
       if (step.question) addMessage('assistant', step.question);
   if (step.answer) addMessage('user', step.answer);
                });

   if (data.finalRecommendation) {
        const rec = data.finalRecommendation;
           addRecommendation(rec.title, rec.description, rec.details);
         }

    addMessage('assistant', `? ${data.message}`);
            } catch (error) {
              console.error('Error:', error);
          addMessage('error', 'Failed to run scenario: ' + error.message);
   }
        }

        function addMessage(type, content) {
            const conversationArea = document.getElementById('conversationArea');
        if (conversationArea.querySelector('.text-muted')) {
      conversationArea.innerHTML = '';
  }

     const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            messageDiv.textContent = content;
   
       conversationArea.appendChild(messageDiv);
            conversationArea.scrollTop = conversationArea.scrollHeight;
        }

   function addRecommendation(title, description, details) {
            const conversationArea = document.getElementById('conversationArea');
       const recDiv = document.createElement('div');
      recDiv.className = 'message recommendation';
   
            let detailsHtml = '';
            if (details && details.length > 0) {
     detailsHtml = '<ul>' + details.map(d => `<li>${d}</li>`).join('') + '</ul>';
  }
   
       recDiv.innerHTML = `<h4>${title}</h4><p>${description}</p>${detailsHtml}`;
            conversationArea.appendChild(recDiv);
        conversationArea.scrollTop = conversationArea.scrollHeight;
        }

        function showInputArea(instructions) {
  document.getElementById('inputArea').style.display = 'block';
          document.getElementById('instructionsText').textContent = instructions || '';
     document.getElementById('userInput').focus();
        }

        function showLoading(message) {
            const conversationArea = document.getElementById('conversationArea');
        conversationArea.innerHTML = `
    <div class="text-center text-muted py-5">
      <div class="spinner-border text-success mb-3" role="status"></div>
  <p>${message}</p>
            </div>
            `;
        }

        function clearConversation() {
  document.getElementById('conversationArea').innerHTML = '';
         document.getElementById('inputArea').style.display = 'none';
  }

        function resetDemo() {
   currentSessionId = null;
            clearConversation();
          document.getElementById('conversationArea').innerHTML = `
     <div class="text-center text-muted py-5">
        <i class="bi bi-chat-dots display-1"></i>
           <p class="mt-3">Click "Start Demo" to begin</p>
    </div>
       `;
        }
    </script>
</body>
</html>
