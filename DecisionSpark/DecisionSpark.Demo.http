### DecisionSpark Demo API Tests
### Interactive Conversation Flow
### 
### This file demonstrates the complete conversation flow
### from start to final recommendation without needing API keys.
###

### Variables
@baseUrl = https://localhost:44356
@contentType = application/json

###############################################################################
### QUICK START SCENARIOS
### These run complete conversations with predefined answers
###############################################################################

###############################################################################
### Scenario 1: Bowling Night
### Family of 6, ages 8-40 ? Should recommend BOWLING
###############################################################################

GET {{baseUrl}}/demo/scenario/bowling

###############################################################################
### Scenario 2: Movie Night
### Family of 4 with toddler (age 3) ? Should recommend MOVIE_NIGHT
###############################################################################

GET {{baseUrl}}/demo/scenario/movie

###############################################################################
### Scenario 3: Golfing
### Group of 3 teens ? Should recommend GOLFING
###############################################################################

GET {{baseUrl}}/demo/scenario/golf

###############################################################################
### INTERACTIVE FLOW - BOWLING EXAMPLE
### Step-by-step conversation (manual)
###############################################################################

###############################################################################
### Step 1: Start Demo Session
### Expected: 200 OK with first question about group size
###############################################################################

GET {{baseUrl}}/demo/start

###
### Response will include:
### - sessionId (copy this for next steps)
### - currentQuestion: "How many people are going on the outing?"
### - continueUrl: "/demo/answer/{sessionId}"
###
### COPY THE sessionId FROM THE RESPONSE BELOW
###############################################################################

@sessionId = PUT_SESSION_ID_HERE

###############################################################################
### Step 2: Answer First Question (Group Size)
### Replace @sessionId with the value from Step 1
### Expected: 200 OK with next question about ages
###############################################################################

POST {{baseUrl}}/demo/answer/{{sessionId}}
Content-Type: {{contentType}}

{
  "answer": "6 people"
}

###
### Alternative valid answers:
### - "6"
### - "six people"
### - "group of 6"
###
### Response will include:
### - questionNumber: 2
### - currentQuestion: "What are the ages of everyone who's going?"
### - answeredSoFar: ["How many people...: 6"]
###

###############################################################################
### Step 3: Answer Second Question (Ages)
### Expected: 200 OK with BOWLING recommendation
###############################################################################

POST {{baseUrl}}/demo/answer/{{sessionId}}
Content-Type: {{contentType}}

{
  "answer": "ages are 8, 10, 12, 35, 37, 40"
}

###
### Alternative valid answers:
### - "8, 10, 12, 35, 37, 40"
### - "8 10 12 35 37 40"
### - "ages: 8, 10, 12, 35, 37, 40"
###
### Response will include:
### - isComplete: true
### - recommendation:
###   - outcomeId: "GO_BOWLING"
### - title: "Bowling night ??"
###   - description: "Bowling is perfect for your crew..."
###   - actionLabel: "Reserve a lane"
###

###############################################################################
### INTERACTIVE FLOW - MOVIE NIGHT EXAMPLE
### Demonstrates immediate rule triggering (min_age < 5)
###############################################################################

###############################################################################
### Movie Step 1: Start New Session
###############################################################################

GET {{baseUrl}}/demo/start

### COPY THE sessionId FROM RESPONSE
@movieSessionId = PUT_SESSION_ID_HERE

###############################################################################
### Movie Step 2: Answer Group Size (4 people)
###############################################################################

POST {{baseUrl}}/demo/answer/{{movieSessionId}}
Content-Type: {{contentType}}

{
  "answer": "4"
}

###############################################################################
### Movie Step 3: Answer Ages (includes age 3 - triggers immediate rule)
### Expected: MOVIE_NIGHT recommendation (min_age < 5 immediate rule)
###############################################################################

POST {{baseUrl}}/demo/answer/{{movieSessionId}}
Content-Type: {{contentType}}

{
  "answer": "3, 6, 35, 37"
}

###
### This triggers the immediate select rule because min_age (3) < 5
### Response includes:
### - recommendation.outcomeId: "MOVIE_NIGHT"
### - recommendation.title: "Movie night ??"
###

###############################################################################
### ERROR HANDLING - INVALID INPUT
###############################################################################

###############################################################################
### Test Invalid Input: Non-numeric answer for group size
### Expected: 400 Bad Request with helpful error message
###############################################################################

GET {{baseUrl}}/demo/start

@errorSessionId = PUT_SESSION_ID_HERE

###

POST {{baseUrl}}/demo/answer/{{errorSessionId}}
Content-Type: {{contentType}}

{
  "answer": "I don't know"
}

###
### Response will include:
### - error: "Could not find a number in your response."
### - hint: "Extract a single integer 1-10."
### - examples: ["5", "3 people", "6"]
### - currentQuestion: "Let me try again. How many people..."
### - retryAttempt: 1
###

###############################################################################
### SESSION MANAGEMENT
###############################################################################

###############################################################################
### Check Session Status
### Get current status of any session
###############################################################################

GET {{baseUrl}}/demo/status/{{sessionId}}

###
### Returns:
### - Current question if in progress
### - Recommendation if complete
### - Answered questions so far
###

###############################################################################
### ADDITIONAL TEST CASES
###############################################################################

###############################################################################
### Test Case: Minimum Group (1 person)
###############################################################################

GET {{baseUrl}}/demo/start
### Copy sessionId

POST {{baseUrl}}/demo/answer/{sessionId}
Content-Type: {{contentType}}

{
  "answer": "1"
}

POST {{baseUrl}}/demo/answer/{sessionId}
Content-Type: {{contentType}}

{
  "answer": "25"
}

###############################################################################
### Test Case: Maximum Group (10 people)
###############################################################################

GET {{baseUrl}}/demo/start
### Copy sessionId

POST {{baseUrl}}/demo/answer/{sessionId}
Content-Type: {{contentType}}

{
  "answer": "10 people"
}

POST {{baseUrl}}/demo/answer/{sessionId}
Content-Type: {{contentType}}

{
  "answer": "5, 7, 9, 11, 13, 35, 37, 39, 41, 43"
}

###############################################################################
### Test Case: All Adults (Golfing preferred)
###############################################################################

GET {{baseUrl}}/demo/start
### Copy sessionId

POST {{baseUrl}}/demo/answer/{sessionId}
Content-Type: {{contentType}}

{
  "answer": "4"
}

POST {{baseUrl}}/demo/answer/{sessionId}
Content-Type: {{contentType}}

{
  "answer": "18, 22, 25, 30"
}

###############################################################################
### COMPARISON: Demo vs Production API
###############################################################################

###
### Demo API (/demo/*)
### - No API key required
### - User-friendly responses
### - Step-by-step guidance
### - Built-in scenarios
### - Helpful error messages
### - Great for testing and demos
###
### Production API (/start, /v2/pub/conversation/*)
### - Requires API key
### - Standardized responses
### - Production-ready
### - Analytics tracking
### - Use in real applications
###

###############################################################################
### SWAGGER UI TESTING
###############################################################################

###
### The demo endpoints are also available in Swagger UI:
###
### 1. Open https://localhost:44356
### 2. Look for "Demo" section
### 3. Try the endpoints interactively:
###    - GET /demo/start
###    - POST /demo/answer/{sessionId}
###    - GET /demo/scenario/{scenarioName}
###    - GET /demo/status/{sessionId}
###
### No authorization required for demo endpoints!
###

###############################################################################
### EXPECTED OUTCOMES SUMMARY
###############################################################################

###
### Bowling Scenario:
### - Group size: 6
### - Ages: 8, 10, 12, 35, 37, 40
### - Min age: 8 (>= 5)
### - Result: GO_BOWLING
###
### Movie Night Scenario:
### - Group size: 4
### - Ages: 3, 6, 35, 37
### - Min age: 3 (< 5 - immediate rule)
### - Result: MOVIE_NIGHT
###
### Golfing Scenario:
### - Group size: 3 (<= 4)
### - Ages: 14, 16, 42
### - Min age: 14 (>= 12)
### - Result: GO_GOLFING
###

###############################################################################
### TESTING TIPS
###############################################################################

###
### 1. Start with the scenario endpoints to see complete flows
### 2. Use the interactive flow to test custom inputs
### 3. Check session status at any time
### 4. Try invalid inputs to see error handling
### 5. Each session is independent - start new ones anytime
### 6. Sessions are in-memory only (cleared on restart)
###
### Happy testing! ??
###

